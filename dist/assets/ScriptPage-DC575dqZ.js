import{r as m,o as ke,x as xe,c as v,a as f,b as o,f as t,w as n,l as c,F as H,d as Z,e as Q,g as X,p as Ve,t as $,y as Se,q as A,s as _,z as Ce,A as $e,B as Be,C as Ee,D as De,m as b,G as Te,H as Ae}from"./vendor-HcLblEBu.js";import{_ as Fe}from"./index-DLbMR7kT.js";const Pe={class:"script-container"},Ue={class:"header-section"},Ie={class:"header-actions"},Me={class:"scripts-section"},ze={key:0,class:"empty-state"},Le={key:1,class:"scripts-grid"},Re=["onClick"],We={class:"script-icon"},Ne={class:"script-info"},Je={class:"script-name"},Ge={key:0,class:"script-desc"},Oe={class:"script-actions"},Ke={class:"terminal-section"},Ye={class:"terminal-header"},je={class:"terminal-controls"},qe={class:"run-dialog-content"},He={class:"script-header"},Ze={class:"header-icon"},Qe={class:"header-text"},Xe={class:"header-title"},et={key:0,class:"params-container"},tt={class:"param-label"},lt={key:1,class:"manual-input"},nt={class:"param-item"},F="http://127.0.0.1:3335",ot="ws://127.0.0.1:3336",at={__name:"ScriptPage",setup(st){const P=m([]),B=m(!1),U=m(null),ee=m(""),R=m(.3);m({});const I=m(null),g=m(!1);let s=null,k=null,d=null;const x=m(!1),p=m({name:"",description:"",content:""}),V=m(!1),E=m(null),S=m(""),w=m([]),M=m(!1),te={background:"transparent",foreground:"#4af626",cursor:"#4af626",cursorAccent:"#1e1e1e",selection:"rgba(74, 246, 38, 0.3)",black:"#1e1e1e",red:"#ff5555",green:"#4af626",yellow:"#f1fa8c",blue:"#6272a4",magenta:"#ff79c6",cyan:"#8be9fd",white:"#f8f8f2",brightBlack:"#6272a4",brightRed:"#ff6e6e",brightGreen:"#69ff94",brightYellow:"#ffffa5",brightBlue:"#d6acff",brightMagenta:"#ff92df",brightCyan:"#a4ffff",brightWhite:"#ffffff"},le={background:"transparent",foreground:"#2c3e50",cursor:"#2c3e50",cursorAccent:"#ffffff",selection:"rgba(44, 62, 80, 0.2)",black:"#000000",red:"#e74c3c",green:"#27ae60",yellow:"#f1c40f",blue:"#2980b9",magenta:"#8e44ad",cyan:"#16a085",white:"#ecf0f1",brightBlack:"#7f8c8d",brightRed:"#c0392b",brightGreen:"#2ecc71",brightYellow:"#f39c12",brightBlue:"#3498db",brightMagenta:"#9b59b6",brightCyan:"#1abc9c",brightWhite:"#ffffff"},W=()=>document.documentElement.classList.contains("dark")||document.documentElement.getAttribute("data-theme")==="dark"?te:le,ne=()=>{s||(s=new Ce.Terminal({cursorBlink:!0,fontSize:14,fontFamily:"'JetBrains Mono', 'Consolas', 'Courier New', monospace",theme:W(),allowTransparency:!0,scrollback:1e3}),k=new $e.FitAddon,s.loadAddon(k),s.loadAddon(new Be.WebLinksAddon),Ee(()=>{I.value&&(s.open(I.value),k.fit(),s.onData(l=>{d&&g.value&&d.send(l)}),N())}))},N=()=>{if(!(d&&g.value))try{const l=s.rows,e=s.cols;d=new WebSocket(ot),d.onopen=()=>{g.value=!0,d.send(`INIT:${l}:${e}`),_.success("ç»ˆç«¯å·²è¿æ¥")},d.onmessage=i=>{s.write(i.data)},d.onclose=()=>{g.value=!1,s.write(`\r
\x1B[1;31m[è¿æ¥å·²æ–­å¼€]\x1B[0m\r
`)},d.onerror=i=>{console.error("WebSocket error:",i),g.value=!1}}catch(l){console.error("Failed to connect WebSocket:",l),_.error("ç»ˆç«¯è¿æ¥å¤±è´¥")}},J=()=>{d&&(d.close(),d=null,g.value=!1)},G=()=>{J(),setTimeout(()=>{N()},500)},O=()=>{k&&s&&(k.fit(),d&&g.value&&d.send(`RESIZE:${s.rows}:${s.cols}`))},D=async()=>{B.value=!0;try{const l=await A.get(`${F}/api/scripts`);P.value=l.data.scripts}catch(l){console.error("Failed to load scripts:",l),_.error("åŠ è½½è„šæœ¬åˆ—è¡¨å¤±è´¥")}finally{B.value=!1}},oe=()=>{p.value={name:"",description:"",content:""},x.value=!0},ae=l=>{const e=new FileReader;return e.onload=i=>{p.value.content=i.target.result,p.value.name||(p.value.name=l.name.replace(/\.py$/,""))},e.readAsText(l.raw),!1},se=async()=>{var l,e;if(!p.value.name||!p.value.content){_.warning("è¯·è¾“å…¥è„šæœ¬åç§°å’Œå†…å®¹");return}try{await A.post(`${F}/api/scripts`,p.value),_.success("è„šæœ¬ä¸Šä¼ æˆåŠŸ"),x.value=!1,D()}catch(i){console.error("Failed to upload script:",i),_.error("ä¸Šä¼ è„šæœ¬å¤±è´¥: "+(((e=(l=i.response)==null?void 0:l.data)==null?void 0:e.detail)||i.message))}},ie=async l=>{try{await Ae.confirm(`ç¡®å®šè¦åˆ é™¤è„šæœ¬ "${l.name}" å—ï¼Ÿ`,"ç¡®è®¤åˆ é™¤",{confirmButtonText:"åˆ é™¤",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await A.delete(`${F}/api/scripts/${l.id}`),_.success("è„šæœ¬å·²åˆ é™¤"),D()}catch(e){e!=="cancel"&&_.error("åˆ é™¤å¤±è´¥")}},re=async l=>{if(!d||!g.value){_.warning("ç»ˆç«¯æœªè¿æ¥ï¼Œæ­£åœ¨é‡è¿..."),G();return}E.value=l,S.value="",w.value=[],V.value=!0,M.value=!0;try{const i=(await A.get(`${F}/api/scripts/${l.id}`)).data.script.content,r=/input\s*\(\s*['"](.*?)['"]\s*\)/g;let u;const h=[];for(;(u=r.exec(i))!==null;)h.push({label:u[1]||`å‚æ•° ${h.length+1}`,value:""});w.value=h}catch(e){console.error("Failed to analyze script inputs:",e),_.warning("æ— æ³•è‡ªåŠ¨åˆ†æè„šæœ¬å‚æ•°ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥")}finally{M.value=!1}},ce=()=>{if(!E.value)return;const l=E.value;s&&s.focus(),s.write(`\r
\x1B[1;36mâ–¶ è¿è¡Œ: `+l.name+`\x1B[0m\r
\r
`),U.value=l.id;const e=`core/script/user_scripts/${l.id}.py`;let i="";w.value.length>0?i=w.value.map(u=>u.value).join(`
`):S.value.trim()&&(i=S.value.trim());let r;if(i){const u=i.replace(/'/g,"'\\''");i.includes(`
`)?r=`echo -e '${i.replace(/\n/g,"\\n")}' | python ${e}`:r=`echo '${u}' | python ${e}`}else r=`python ${e}`;d.send(`CMD:${r}`),V.value=!1},de=()=>{s&&s.clear()};let T=null;const z=()=>{const l=localStorage.getItem("terminal_bg_image"),e=localStorage.getItem("terminal_bg_opacity");ee.value=l||"",R.value=e!==null?parseFloat(e):.3,l?(document.documentElement.style.setProperty("--terminal-bg-image",`url(${l})`),document.documentElement.style.setProperty("--terminal-opacity",R.value)):document.documentElement.style.removeProperty("--terminal-bg-image")};return ke(()=>{D(),ne(),z(),window.addEventListener("resize",O),window.addEventListener("storage",z),T=new MutationObserver(l=>{l.forEach(e=>{e.type==="attributes"&&(e.attributeName==="class"||e.attributeName==="data-theme")&&s&&(s.options.theme=W())})}),T.observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]})}),xe(()=>{J(),s&&s.dispose(),T&&T.disconnect(),window.removeEventListener("storage",z),window.removeEventListener("resize",O)}),(l,e)=>{const i=c("Plus"),r=c("el-icon"),u=c("el-button"),h=c("Refresh"),ue=c("Document"),me=c("Loading"),pe=c("DocumentCopy"),K=c("Delete"),fe=c("el-tag"),C=c("el-input"),L=c("el-form-item"),ve=c("UploadFilled"),ge=c("el-upload"),_e=c("el-form"),Y=c("el-dialog"),j=c("VideoPlay"),be=c("Key"),q=c("el-alert"),ye=De("loading");return f(),v("div",Pe,[o("div",Ue,[e[9]||(e[9]=o("div",{class:"page-header lighting-effect"},[o("h2",null,"ğŸ“œ è„šæœ¬åº“"),o("span",{class:"subtitle"},"Script Library")],-1)),o("div",Ie,[t(u,{type:"primary",onClick:oe,round:""},{default:n(()=>[t(r,null,{default:n(()=>[t(i)]),_:1}),e[8]||(e[8]=b(" ä¸Šä¼ è„šæœ¬ ",-1))]),_:1}),t(u,{onClick:D,loading:B.value,circle:""},{default:n(()=>[t(r,null,{default:n(()=>[t(h)]),_:1})]),_:1},8,["loading"])])]),o("div",Me,[P.value.length===0&&!B.value?(f(),v("div",ze,[t(r,{class:"empty-icon"},{default:n(()=>[t(ue)]),_:1}),e[10]||(e[10]=o("p",null,"è¿˜æ²¡æœ‰è„šæœ¬",-1)),e[11]||(e[11]=o("p",{class:"hint"},'ç‚¹å‡»ä¸Šæ–¹"ä¸Šä¼ è„šæœ¬"æŒ‰é’®æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªè„šæœ¬',-1))])):(f(),v("div",Le,[(f(!0),v(H,null,Z(P.value,a=>(f(),v("div",{key:a.id,class:Q(["script-card",{running:U.value===a.id}])},[o("div",{class:"script-main",onClick:y=>re(a)},[o("div",We,[U.value===a.id?(f(),X(r,{key:0,class:"is-loading"},{default:n(()=>[t(me)]),_:1})):(f(),X(r,{key:1},{default:n(()=>[t(pe)]),_:1}))]),o("div",Ne,[o("div",Je,$(a.name),1),a.description?(f(),v("div",Ge,$(a.description),1)):Ve("",!0)])],8,Re),o("div",Oe,[t(u,{link:"",type:"danger",size:"small",onClick:Se(y=>ie(a),["stop"])},{default:n(()=>[t(r,null,{default:n(()=>[t(K)]),_:1})]),_:1},8,["onClick"])])],2))),128))]))]),o("div",Ke,[o("div",Ye,[e[14]||(e[14]=o("span",null,"ğŸ–¥ï¸ äº¤äº’å¼ç»ˆç«¯ (Interactive Terminal)",-1)),o("div",je,[t(fe,{class:Q(["status-tag",g.value?"status-connected":"status-disconnected"]),size:"small",effect:"dark"},{default:n(()=>[b($(g.value?"å·²è¿æ¥":"æœªè¿æ¥"),1)]),_:1},8,["class"]),t(u,{link:"",size:"small",onClick:G},{default:n(()=>[t(r,null,{default:n(()=>[t(h)]),_:1}),e[12]||(e[12]=b(" é‡è¿ ",-1))]),_:1}),t(u,{link:"",size:"small",onClick:de},{default:n(()=>[t(r,null,{default:n(()=>[t(K)]),_:1}),e[13]||(e[13]=b(" æ¸…å± ",-1))]),_:1})])]),o("div",{class:"terminal-body",ref_key:"terminalRef",ref:I},null,512)]),t(Y,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=a=>x.value=a),title:"ä¸Šä¼ è„šæœ¬",width:"600px",class:"upload-dialog"},{footer:n(()=>[t(u,{onClick:e[3]||(e[3]=a=>x.value=!1)},{default:n(()=>[...e[16]||(e[16]=[b("å–æ¶ˆ",-1)])]),_:1}),t(u,{type:"primary",onClick:se},{default:n(()=>[...e[17]||(e[17]=[b("ä¸Šä¼ ",-1)])]),_:1})]),default:n(()=>[t(_e,{"label-position":"top"},{default:n(()=>[t(L,{label:"è„šæœ¬åç§°"},{default:n(()=>[t(C,{modelValue:p.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value.name=a),placeholder:"ä¾‹å¦‚ï¼šæ•°æ®å¤„ç†è„šæœ¬"},null,8,["modelValue"])]),_:1}),t(L,{label:"æè¿° (å¯é€‰)"},{default:n(()=>[t(C,{modelValue:p.value.description,"onUpdate:modelValue":e[1]||(e[1]=a=>p.value.description=a),placeholder:"è„šæœ¬åŠŸèƒ½æè¿°..."},null,8,["modelValue"])]),_:1}),t(L,{label:"è„šæœ¬å†…å®¹"},{default:n(()=>[t(ge,{drag:"","auto-upload":!1,"on-change":ae,accept:".py","show-file-list":!1,style:{width:"100%","margin-bottom":"12px"}},{default:n(()=>[t(r,{class:"el-icon--upload"},{default:n(()=>[t(ve)]),_:1}),e[15]||(e[15]=o("div",{class:"el-upload__text"},[b(" æ‹–æ‹½ .py æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ– "),o("em",null,"ç‚¹å‡»ä¸Šä¼ ")],-1))]),_:1}),t(C,{modelValue:p.value.content,"onUpdate:modelValue":e[2]||(e[2]=a=>p.value.content=a),type:"textarea",rows:10,placeholder:"# åœ¨æ­¤ç²˜è´´æˆ–ç¼–å†™ Python ä»£ç ...",style:{"font-family":"'JetBrains Mono', monospace"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Y,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=a=>V.value=a),title:"è¿è¡Œè„šæœ¬",width:"500px",class:"run-dialog"},{footer:n(()=>[t(u,{onClick:e[6]||(e[6]=a=>V.value=!1)},{default:n(()=>[...e[20]||(e[20]=[b("å–æ¶ˆ",-1)])]),_:1}),t(u,{type:"primary",onClick:ce},{default:n(()=>[t(r,null,{default:n(()=>[t(j)]),_:1}),e[21]||(e[21]=b(" è¿è¡Œ ",-1))]),_:1})]),default:n(()=>{var a;return[Te((f(),v("div",qe,[o("div",He,[o("div",Ze,[t(r,null,{default:n(()=>[t(j)]),_:1})]),o("div",Qe,[o("div",Xe,$((a=E.value)==null?void 0:a.name),1),e[18]||(e[18]=o("div",{class:"header-desc"},"é…ç½®è¿è¡Œå‚æ•°",-1))])]),w.value.length>0?(f(),v("div",et,[(f(!0),v(H,null,Z(w.value,(y,he)=>(f(),v("div",{key:he,class:"param-item"},[o("div",tt,[t(r,null,{default:n(()=>[t(be)]),_:1}),b(" "+$(y.label),1)]),t(C,{modelValue:y.value,"onUpdate:modelValue":we=>y.value=we,placeholder:"è¯·è¾“å…¥ "+y.label,type:"textarea",rows:2,style:{"font-family":"'JetBrains Mono', monospace"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))),128)),t(q,{title:"å‚æ•°å°†è‡ªåŠ¨ä¼ é€’ç»™è„šæœ¬",type:"info","show-icon":"",closable:!1,class:"info-alert"})])):(f(),v("div",lt,[o("div",nt,[e[19]||(e[19]=o("div",{class:"param-label"},"è¾“å…¥å‚æ•° (å¯é€‰)",-1)),t(C,{modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=y=>S.value=y),type:"textarea",rows:3,placeholder:`è„šæœ¬æœªæ£€æµ‹åˆ° input() è°ƒç”¨ï¼Œå¦‚æœéœ€è¦è¾“å…¥è¯·åœ¨æ­¤æ‰‹åŠ¨é”®å…¥...
è¾“å…¥åå°†è‡ªåŠ¨å‘é€åˆ°ç»ˆç«¯`,style:{"font-family":"'JetBrains Mono', monospace"}},null,8,["modelValue"])]),t(q,{title:"ç•™ç©ºåˆ™ç›´æ¥è¿è¡Œï¼Œå¯åœ¨ç»ˆç«¯ä¸­äº¤äº’",type:"warning","show-icon":"",closable:!1,class:"info-alert"})]))])),[[ye,M.value]])]}),_:1},8,["modelValue"])])}}},ct=Fe(at,[["__scopeId","data-v-9bb75125"]]);export{ct as default};
